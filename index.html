<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RaceManager Pro</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>
    
    <!-- Modern CSS -->
    <link rel="stylesheet" href="styles/modern.css">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="site.webmanifest">
</head>
<body class="bg-gray-900 text-white antialiased">
    <!-- Vanta.js Background -->
    <div id="vanta-bg"></div>
    
    <!-- Racing Particles Overlay -->
    <div id="particles-overlay" class="fixed inset-0" style="z-index: -5;">
        <canvas id="particles-canvas" class="absolute inset-0 w-full h-full"></canvas>
    </div>

    <!-- Loading Screen -->
    <div id="loadingScreen" class="relative z-50 min-h-screen flex items-center justify-center bg-gray-900">
        <div class="text-center">
            <div class="relative mb-8">
                <div class="w-20 h-20 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mx-auto"></div>
                <div class="absolute inset-0 w-20 h-20 border-4 border-red-500/30 border-b-transparent rounded-full animate-spin mx-auto" style="animation-direction: reverse; animation-duration: 1.5s;"></div>
            </div>
            <h2 class="text-2xl font-bold mb-4 bg-gradient-to-r from-red-400 to-orange-400 bg-clip-text text-transparent">
                RaceManager Pro
            </h2>
            <p class="text-gray-400 animate-pulse">Loading your racing experience...</p>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="relative z-40 min-h-screen flex items-center justify-center bg-gray-900/95 backdrop-blur-sm" style="display: none;">
        <div class="w-full max-w-md mx-auto p-6">
            <!-- Login Container -->
            <div id="login-container" class="glass-card p-8 rounded-2xl">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold mb-2 bg-gradient-to-r from-red-400 to-orange-400 bg-clip-text text-transparent">
                        RaceManager Pro
                    </h1>
                    <p class="text-gray-400">Enter the world of professional racing</p>
                </div>

                <!-- Google Login -->
                <button 
                    id="google-login-btn" 
                    class="auth-btn w-full racing-btn flex items-center justify-center space-x-3 py-3 px-6 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 mb-4"
                >
                    <svg class="w-5 h-5" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    <span>Continue with Google</span>
                </button>
                
                <div class="relative mb-4">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-600"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-2 bg-gray-900 text-gray-400">Or continue with email</span>
                    </div>
                </div>

                <!-- Email Login Form -->
                <form id="login-form" class="space-y-4">
                    <div>
                        <input
                            type="text"
                            id="login-email"
                            placeholder="Username or Email"
                            class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none transition-all"
                            required
                        >
                    </div>
                    <div class="relative">
                        <input
                            type="password"
                            id="login-password"
                            placeholder="Password"
                            class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none transition-all pr-10"
                            required
                        >
                        <button type="button" id="toggle-password" class="absolute right-3 top-2.5 text-gray-400 hover:text-gray-300">
                            <i data-feather="eye" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <button type="submit" class="auth-btn w-full racing-btn py-3 font-semibold">
                        Sign In
                    </button>
                </form>
                
                <div class="text-center text-sm text-gray-400 mt-6">
                    <p>New to racing? <a href="#" id="show-signup-btn" class="text-orange-400 hover:text-orange-300 font-semibold">Create account</a></p>
                </div>
            </div>
            
            <!-- Signup Container -->
            <div id="signup-container" class="glass-card p-8 rounded-2xl" style="display: none;">
                <div class="flex items-center justify-between mb-8">
                    <button id="back-to-login-btn" class="text-gray-400 hover:text-white transition-colors">
                        <i data-feather="arrow-left" class="w-5 h-5"></i>
                    </button>
                    <div class="text-center flex-1">
                        <h2 class="text-2xl font-bold mb-2">Join the Race</h2>
                        <p class="text-gray-400">Create your racing profile</p>
                    </div>
                    <div class="w-8"></div> <!-- Spacer for balance -->
                </div>

                <form id="signup-form" class="space-y-4">
                    <div>
                        <input
                            type="email"
                            id="signup-email"
                            placeholder="Email Address"
                            class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none transition-all"
                            required
                        >
                    </div>
                    <div class="relative">
                        <input
                            type="password"
                            id="signup-password"
                            placeholder="Password"
                            class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none transition-all pr-10"
                            required
                        >
                        <button type="button" class="absolute right-3 top-2.5 text-gray-400 hover:text-gray-300">
                            <i data-feather="eye" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <div>
                        <input
                            type="password"
                            id="signup-confirm-password"
                            placeholder="Confirm Password"
                            class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none transition-all"
                            required
                        >
                    </div>
                    <button type="submit" class="auth-btn w-full racing-btn py-3 font-semibold">
                        Create Account
                    </button>
                </form>
                
                <div class="text-center text-sm text-gray-400 mt-6">
                    <p>Already have an account? <a href="#" id="show-login-btn" class="text-orange-400 hover:text-orange-300 font-semibold">Sign in</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Setup Screen -->
    <div id="profile-setup-screen" class="relative z-40 min-h-screen flex items-center justify-center bg-gray-900/95 backdrop-blur-sm" style="display: none;">
        <div class="w-full max-w-md mx-auto p-6">
            <div class="glass-card p-8 rounded-2xl">
                <div class="flex items-center justify-between mb-8">
                    <button id="back-to-signup-btn" class="text-gray-400 hover:text-white transition-colors">
                        <i data-feather="arrow-left" class="w-5 h-5"></i>
                    </button>
                    <div class="text-center flex-1">
                        <h2 class="text-2xl font-bold mb-2">Complete Your Profile</h2>
                        <p class="text-gray-400">Let's set up your racing identity</p>
                    </div>
                    <div class="w-8"></div> <!-- Spacer for balance -->
                </div>

                <form id="profile-setup-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Email</label>
                        <input
                            type="email"
                            id="setup-email"
                            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-300 cursor-not-allowed"
                            readonly
                        >
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Username</label>
                        <input
                            type="text"
                            id="setup-username"
                            placeholder="Choose a unique username"
                            class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none transition-all"
                            required
                        >
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Display Name</label>
                        <input
                            type="text"
                            id="setup-displayname"
                            placeholder="Your display name"
                            class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none transition-all"
                            required
                        >
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Profile Picture (Optional)</label>
                        <input
                            type="url"
                            id="setup-avatar"
                            class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none transition-all"
                            placeholder="https://example.com/avatar.jpg"
                        >
                        <p class="text-xs text-gray-500 mt-1">Enter a URL for your profile picture</p>
                    </div>
                    
                    <button type="submit" class="auth-btn w-full racing-btn py-3 font-semibold">
                        Complete Sign Up
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="relative z-30" style="display: none;">
        <!-- Navigation Header -->
        <nav class="fixed top-0 left-0 right-0 z-50 bg-gray-900/95 backdrop-blur-md border-b border-gray-800">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <!-- Logo -->
                    <div class="flex-shrink-0">
                        <a href="#" data-nav-item="feed" class="flex items-center space-x-2">
                            <div class="w-8 h-8 bg-gradient-to-br from-red-500 to-orange-500 rounded-lg flex items-center justify-center">
                                <i data-feather="zap" class="w-5 h-5 text-white"></i>
                            </div>
                            <span class="text-xl font-bold bg-gradient-to-r from-red-400 to-orange-400 bg-clip-text text-transparent">
                                RaceManager Pro
                            </span>
                        </a>
                    </div>
                    
                    <!-- Desktop Navigation -->
                    <div class="hidden md:block">
                        <div class="ml-10 flex items-baseline space-x-4">
                            <a href="#" data-nav-item="feed" class="nav-link">
                                <i data-feather="home" class="w-4 h-4"></i>
                                <span>Feed</span>
                            </a>
                            <a href="#" data-nav-item="championships" class="nav-link">
                                <i data-feather="award" class="w-4 h-4"></i>
                                <span>Championships</span>
                            </a>
                        </div>
                    </div>
                    
                    <!-- User Menu -->
                    <div class="flex items-center space-x-4">
                        <!-- Search -->
                        <button id="search-btn" class="p-2 text-gray-400 hover:text-white transition-colors">
                            <i data-feather="search" class="w-5 h-5"></i>
                        </button>
                        
                        <!-- Notifications system removed for simplification -->
                        
                        <!-- User Profile -->
                        <div class="relative">
                            <button id="user-menu-btn" class="flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-800 transition-colors">
                                <div id="user-avatar" class="w-8 h-8 bg-gradient-to-br from-red-500 to-orange-500 rounded-full flex items-center justify-center text-white font-bold text-sm">
                                    U
                                </div>
                                <span id="user-name" class="hidden sm:block text-sm font-medium">User</span>
                                <i data-feather="chevron-down" class="w-4 h-4"></i>
                            </button>
                            
                            <!-- Dropdown Menu -->
                            <div id="user-dropdown" class="absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-lg border border-gray-700 hidden">
                                <a href="#" data-nav-item="profile" class="block px-4 py-2 text-sm hover:bg-gray-700 rounded-t-lg">
                                    <i data-feather="user" class="w-4 h-4 inline mr-2"></i>
                                    Profile
                                </a>
                                <button data-action="settings" class="w-full text-left block px-4 py-2 text-sm hover:bg-gray-700">
                                    <i data-feather="settings" class="w-4 h-4 inline mr-2"></i>
                                    Settings
                                </button>
                                <hr class="border-gray-700">
                                <button id="logout-btn" class="w-full text-left px-4 py-2 text-sm hover:bg-gray-700 rounded-b-lg text-red-400">
                                    <i data-feather="log-out" class="w-4 h-4 inline mr-2"></i>
                                    Logout
                                </button>
                            </div>
                        </div>
                        
                        <!-- Mobile Menu Button -->
                        <button id="mobile-menu-btn" class="md:hidden p-2 text-gray-400 hover:text-white transition-colors">
                            <i data-feather="menu" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Navigation -->
            <div id="mobile-menu" class="md:hidden hidden">
                <div class="px-2 pt-2 pb-3 space-y-1 bg-gray-800 border-t border-gray-700">
                    <a href="#" data-nav-item="feed" class="mobile-nav-link">
                        <i data-feather="home" class="w-4 h-4"></i>
                        Feed
                    </a>
                    <a href="#" data-nav-item="championships" class="mobile-nav-link">
                        <i data-feather="award" class="w-4 h-4"></i>
                        Championships
                    </a>
                </div>
            </div>
        </nav>
        
        <!-- Page Content -->
        <main class="pt-16">
            <!-- Page Container -->
            <div id="app-container" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                <!-- Page content will be dynamically loaded here -->
                <div class="text-center py-20">
                    <div class="animate-spin w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full mx-auto mb-4"></div>
                    <p class="text-gray-400">Loading page...</p>
                </div>
            </div>
        </main>
        
        <!-- Page Loader -->
        <div id="page-loader" class="fixed inset-0 bg-gray-900/50 backdrop-blur-sm z-50 flex items-center justify-center hidden">
            <div class="text-center">
                <div class="animate-spin w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full mx-auto mb-4"></div>
                <p class="text-white">Loading...</p>
            </div>
        </div>
    </div>

    <!-- Search Modal -->
    <div id="search-modal" class="fixed inset-0 bg-gray-900/90 backdrop-blur-sm z-50 flex items-start justify-center pt-20 hidden">
        <div class="bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl mx-4">
            <div class="p-4 border-b border-gray-700">
                <div class="flex items-center space-x-4">
                    <i data-feather="search" class="w-5 h-5 text-gray-400"></i>
                    <input
                        id="search-input"
                        type="text"
                        placeholder="Search users, posts, championships..."
                        class="flex-1 bg-transparent text-white placeholder-gray-400 outline-none text-lg"
                        autocomplete="off"
                    />
                    <button id="close-search" class="text-gray-400 hover:text-white">
                        <i data-feather="x" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
            <div id="search-results" class="max-h-96 overflow-y-auto">
                <div class="p-6 text-center text-gray-400">
                    <i data-feather="search" class="w-12 h-12 mx-auto mb-4 opacity-50"></i>
                    <p>Start typing to search...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Three.js (required for Vanta.js) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    
    <!-- Vanta.js Waves -->
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.waves.min.js"></script>
    
    <!-- Firebase Configuration -->
    <script type="module" src="js/firebase.js"></script>
    
    <!-- New Microservices Architecture -->
    <script type="module" src="js/RaceManagerPro.js"></script>

    <script>
        // Initialize Feather Icons
        feather.replace();
        
        // Initialize Vanta.js Waves Background
        let vantaEffect = null;
        
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Vanta WAVES with elegant secondary color
            vantaEffect = VANTA.WAVES({
                el: "#vanta-bg",
                mouseControls: true,
                touchControls: true,
                gyroControls: false,
                minHeight: 200.00,
                minWidth: 200.00,
                scale: 1.00,
                scaleMobile: 1.00,
                color: 0x1e3a5f, // Deep Teal Blue - elegant secondary color
                shininess: 30.00,
                waveHeight: 12.00,
                waveSpeed: 0.6,
                zoom: 0.8,
                material: {
                    options: {
                        fog: true,
                        wireframe: false
                    }
                }
            });
            
            // Initialize racing particles
            initRacingBackground();
            
            // Setup navigation
            setupNavigation();
        });
        
        // Navigation Setup
        function setupNavigation() {
            // User menu dropdown
            const userMenuBtn = document.getElementById('user-menu-btn');
            const userDropdown = document.getElementById('user-dropdown');
            
            if (userMenuBtn && userDropdown) {
                userMenuBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    userDropdown.classList.toggle('hidden');
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', () => {
                    userDropdown.classList.add('hidden');
                });
            }
            
            // Mobile menu
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            
            if (mobileMenuBtn && mobileMenu) {
                mobileMenuBtn.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                });
            }
        }
        
        // Racing Background Particles
        function initRacingBackground() {
            const canvas = document.getElementById('particles-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            let animationId;
            
            // Set canvas size
            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // Particles array
            const particles = [];
            const maxParticles = 50;
            
            // Particle class
            class Particle {
                constructor() {
                    this.reset();
                    this.y = Math.random() * canvas.height;
                    this.opacity = Math.random() * 0.5 + 0.2;
                }
                
                reset() {
                    this.x = -10;
                    this.y = Math.random() * canvas.height;
                    this.size = Math.random() * 3 + 1;
                    this.speed = Math.random() * 2 + 1;
                    this.opacity = Math.random() * 0.5 + 0.2;
                    this.color = Math.random() > 0.5 ? '#f97316' : '#dc2626'; // Orange or Red
                }
                
                update() {
                    this.x += this.speed;
                    this.opacity *= 0.999;
                    
                    if (this.x > canvas.width + 10 || this.opacity < 0.1) {
                        this.reset();
                    }
                }
                
                draw() {
                    ctx.save();
                    ctx.globalAlpha = this.opacity;
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                }
            }
            
            // Initialize particles
            for (let i = 0; i < maxParticles; i++) {
                particles.push(new Particle());
            }
            
            // Animation loop
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                particles.forEach(particle => {
                    particle.update();
                    particle.draw();
                });
                
                animationId = requestAnimationFrame(animate);
            }
            
            animate();
            
            // Cleanup function
            return () => {
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
            };
        }

        // Initialize Feather icons when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            if (window.feather) {
                feather.replace();
            }
        });

        // Also initialize icons after any dynamic content changes
        const observer = new MutationObserver(() => {
            if (window.feather) {
                feather.replace();
            }
        });

        observer.observe(document.body, {
            childList: true,
            subtree: true
        });
    </script>
</body>
</html>